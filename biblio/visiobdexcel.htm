<html><head>
<title>Связь шейпов Visio с данными в Excel</title>
<meta name="GENERATOR" content="MSHTML 5.00.2614.3500">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<LINK REL="STYLESHEET" HREF="vis.css">
<link rel="icon" href="favicon.ico" />
</head>
<body bgcolor="white">
<div class="body_div">
<table class="tft" width="100%"><tr>
<td width="20%" align="center"><a href="index.html"><img SRC="vl1.gif" WIDTH="177" HEIGHT="80" BORDER="0" ALT=""></a>&nbsp;</td>
<td width="10%" align="center">&nbsp;</td>
<td class='menutd' width="70%" align="center">
 <a class="menu" href="http://visio.getbb.ru/">Форум visio.getbb.ru</a> |
 <a class="menu" href="reg.htm">О форумах</a>
<br/>
 <a class="menu" href="bib.htm">Библиотека</a> |
 <a class="menu" href="faq.htm">Частые вопросы</a> |
 <a class="menu" href="bookpdf.htm">Литература</a> |
 <a class="menu" href="loading.htm">Склад материалов</a>
<br/>
 <a class="menu" href="navi/png_1.htm">Visio Navigator</a> |
 <a class="menu" href="blog/">Blog</a> |
 <a class="menu" href="inforesurs.htm">Полезные ссылки</a> |
 <a class="menu" href="site.htm">О сайте</a>
<br/>
 <a class="menu" href="visicorp.htm">История Visio</a> |
 <a class="menu" href="product.htm">Продукты Visio</a>
</td></tr></table>
<table width="100%" cellpadding="0" cellspacing="0" class="min"><tr><td width="10%" align="center">&nbsp;</td>
	<td width="90%">&nbsp;&nbsp;Для русскоязычных пользователей Visio. Начинающих и профессионалов.
Где взять, как сделать, что купить и т.д.
</td></tr></table>
<!-- основной контент -->

<h1>Связь шейпов Visio с данными в Excel</h1>
<p>Вопрос связи Visio с базами данных очень обширен и его не рассмотришь в одной статье.
Поэтому для начала (по просьбам из форума) разберемся с одним из узких частных случаев.</p>
<p>Допустим, возникла задача отображать некоторые данные из Excel в шейпах на рисунке Visio.
Пусть на машине установлены Excel 2000 и Visio 2003. Будем выводить один из столбцов данных в качестве текста шейпов.</p>
<h2>Подготовка таблицы в Excel</h2>
<p>Связь удобнее настраивать, когда данные в Excel оформлены в виде именованного диапазона.
Выделим на листе Excel небольшую область, заполним ее данными, озаглавим столбцы. Получили такую маленькую табличку.</p>
<IMG SRC="r0.png" WIDTH="369" HEIGHT="285" BORDER="0" ALT="">
<P>Чтобы превратить ее в именованный диапазон достаточно вписать в поле, помеченное стрелкой какое-нибудь название.
Пусть наша табличка называется tab1. Сохраним этот файл.</P>
<H2>Подключение к базе данных</H2>
<P>Открываем Visio, создаем пустой рисунок.</P>
<P>Рисуем квадратик. Это шейп, который мы будем связывать с базой.</P>
<P>Вызываем Add-On из группы Visio Extras под названием Database Setting.</P>
<IMG SRC="r5.png" WIDTH="385" HEIGHT="294" BORDER="0" ALT="">
<P>Выбираем в поле Default ODBC Data Source значение Excel Files.
В зависимости от настроек и установок на конкретной машине название источника может слегка отличаться.
Например, источник может называться "Файлы Excel". Это не обязательная операция.
Она нужна только для того, чтобы потом меньше путаться с разными диалоговыми окнами.</P>
<P>Теперь селектируем нарисованный квадратик и вызываем Add-On из группы Visio Extras под названием Link to Database.</P>
<IMG SRC="r3.png" WIDTH="500" HEIGHT="456" BORDER="0" ALT="">
<P>Открывается форма выбора файла Excel. Разыскиваем в ней ранее созданный файл и жмем OK. Появляется самая нужная форма.</P>
<P>В поле Name выбираем тип источника Excel Files (хотя он там должен появиться по умолчанию).
В поле Table/view должна появиться созданная в Excel таблица. В файле Excel может быть несколько именованных диапазонов.
Тогда и таблиц будет несколько, можно будет выбрать из них нужную.</P>
<P>В поле Field links появится список полей таблицы и их типы. Выбираем в качестве связного первое поле (a) и жмем OK.</P> 
<IMG SRC="r4.png" WIDTH="691" HEIGHT="433" BORDER="0" ALT="">
<P>Основная операция проведена. Add-On добавил к нашему шейпу несколько строк Custom Properties, добавил также в секцию User
информацию о связи с базой. В шейпе появилось также встроенное меню с четырьмя основными командами работы с данными.
Если в предыдущем окошке нажать на кнопку Advanced, то можно было бы сократить список этих команд,
сняв ненужные галочки в столбце Shape Actions.</P>
<IMG SRC="r2.png" WIDTH="800" HEIGHT="461" BORDER="0" ALT="">
<P>Осталось связать шейп с конкретной строкой данных и вывести значение в виде текста.</P>
<P>Выбираем в контекстном меню шейпа Select Database Record, щелкаем по тому же файлу в окне выбора файла
и получаем окошко Select Database Record. В нем показано ключевое поле нашей таблицы и список возможных значений
(выше мы заполнили четыре строки). Щелкаем по одному из значений, связывая тем самым данный шейп с данной строкой таблицы.</P>
<H2>Отображение данных</H2>
<P>Шейп со строкой данных мы связали. Теперь налаживаем отображение.</P>
<P>На селектированном шейпе выполняем Insert Field. Выбираем Custom Properties и столбец b.
Значение столбца b появляется в виде текста шейпа.</P>
<P>Для полноты картины копируем полученный шейп еще в двух экземплярах. Все его свойства переносятся и в копии.
Для каждой копии выполняем операцию Select Database Record и связываем их с другими значениями ключа (другими строками таблицы).</P>
<H2>Проверка связи</H2>
<P>Проверяем отслеживание изменений. Открываем лист Excel и изменяем какое-либо из отображаемых значений.
На шейпе, связанном с этой строкой, выбираем в контекстном меню Refresh Shape Properties.
Наблюдаем, как меняется текст шейпа - значение заменяется тем, которое ввели в таблицу.</P>
<P>Можно отправить данные и в обратную сторону. Изменим значение Custom Properties в одном из шейпов
(при этом текст шейпа изменится сразу) и выберем в контекстном меню Update Dabase Record. Видим, что в Excel
значение тоже изменилось.</P>
<P>Поставленная задача выполнена.</P>

<!-- --------------------------- -->
<div id="menu-line">
<a href="mailto:gCroc@yandex.ru">Gennady Tumanov</a>
</div>

</div>
</body>
</html>
